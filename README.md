Kursova Software engineering in control systems
===============================================
Курсова робота на тему: "Розробка системи розумний будинок" 

  Розробники проекту студенти групи АК3-2ск

-Квотченко Дмитро Олександрович

-Андрієнко Даниїл Вікторович

-Хом'яков Станіслав Вікторович






             ЗАВДАННЯ

[Розробка вимог до системи та ПЗ.](#sus1)

  1. Загальний опис проектованої системи.
  2. Вимоги до функцій та задач.
  3. Вимоги до видів забезпечення.

[Розробка архітектури та необхідної проектної документації.](#sus2) 

  1. Технічна структура системи (структура комплексу технічних засобів).
  2. Принципові схеми та схеми підключення.
  3. Відомість апаратних та програмних засобів.
  4. Програмна структура системи.

[Методика перевірки та засобів тестування.](#sus3) 

  1. Методика перевірки підсистеми Edge-рівня.
  2. Методика перевірки функцій архівування.
  3. Методика перевірки аналітичних сервісів.
  4. Методика перевірки діалогових сервісів.

[Розробка та налагодження програмного забезпечення та супровідної документації.](#sus4) 

  1. ПЗ для Edge-рівня.
  2. Схеми інформаційної взаємодії
  3. ПЗ для хмарних рішень
  4. WEB-інтерфейси (локальний для Edge та глобальний)

**<a id="sus1">Розділ 1. Розробка вимог до системи та ПЗ.</a>**

**1.1 Загальний опис проектованої системи**

Дана система повинна відстежувати в реальному часі показники температури в середині дому та зовні, показник вологи в приміщенні та рівень освітленості зовні. Система має давати змогу автоматичного керування температурою приміщення а також керування освітленням на подвір'ї у двох режимах: ручному та автоматичному, і в приміщенні в ручному режимі; також у будинку повинна бути система сигналізації всі функції керування повинні мати віддалений доступ для користувача. З певною періодичністю дані про стан всіх показників повинні архівуватися в локальну базу даних та на віддалені хмарні ресурси з можливістю архівування та онлайн контролю.

**1.2 Вимоги до функцій та задач**

Система повинна мати такий набір функцій:

1. Неперервне вимірювання температури в приміщенні та за його межами, також вимірювання вологи в приміщенні з періодичністю не більше 2 секунд.
2. Автоматичне регулювання температури приміщення з можливістю задавання необхідного значення.
3. Можливість керування освітленням в приміщенні та на подвір'ї.
4. Систему сигналізації з можливістю інформування користувача про проникнення в оселю сторонніх осіб.
5. Можливість відображення та контролю параметрів на локальному ВЕБ-інтерфейсі та віддалено за допомогою телеграм-бота та мобільного застосунку.

- На локальному ВЕБ-інтерфейсі та мобільному застосунку повинні бути присутні елементи керування а також відображення актуальних показників, також повинна бути функція формування звіту за останню годину в окремий файл.

1. В телеграм-боті повинно бути реалізовано команди для моніторингу необхідного параметру та для його зміни, окрім цього має бути присутня функція оповіщення тривоги у випадку спрацювання сигналізації. Занесення даних у локальну та віддалену бази даних з періодичністю раз на хвилину та функція створення звіту за запитом.
2. Формування звітів за запитом або періодично раз у годину на локальному ВЕБ-інтерфейсі, з усіма показниками.

**1.3 Вимоги до видів забезпечення**

Вимоги до апаратного забезпечення:

1. ArduinoNANO та ArduinoUNO або аналогічні мікроконтролери.
2. Датчики:

- Температури (2 шт.);
- Вологи (1 шт.);
- Освітленості (1 шт.);
- Кнопки (3 шт.);

1. Виконавчі механізми:

- Нагрівальний елемент (1 шт.);
- Охолоджувальний елемент (1 шт.);
- Динамік (1 шт.);
- Світлодіоди (3 шт.).

1. Смартфон або планшет з Android \> 5V.
2. Прототип буде знаходитися в кімнатних умовах.

Вимоги до програмного забезпечення:

1. Node-RED як база для розробки ПЗ + dashboard для локального веб-інтерфейсу.
2. ArduinoIDE як база розробки ПЗ для мікроконтролерів.
3. Система керування базами даних, розгорнута на RPI (MariaDB).
4. Хмарний застосунок Google Sheets для аналітики.
5. Веб-сайт для онлайн доступу для звітів на базі Google Sites.
6. Telegram-бот для віддаленого контролю та керування.
7. MQTT Dashboard для віддаленого контролю та керування.

**<a id="sus2">Розділ 2. Розробка архітектури та необхідної проектної документації</a>**

**2.1Технічна структура системи (структура комплексу технічних засобів)**

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/struckt.jpg)

Рис. 2.1.1 – Технічна структурна схема

Система являє собою структуру з двох мікроконтролерів до яких під'єднані датчики та виконавчі механізми. Мікроконтролери Arduino UNO та Arduino NANO з'єднані в одну систему за допомогою USB з'єднання до комп'ютера з необхідним програмним забезпеченням який в даному випадку виконує функцію керування системою.

До Arduino UNO під'єднано наступні компоненти:

- Датчик освітленості KY-018;
- Датчик температури KY-013;
- Датчик температури та вологи DTH-11;
- Світлодіод.

Датчик освітленості KY-018 під'єднано до AI піну тому, що даний датчик аналогового типу без вбудованого АЦП, та має живлення від мікроконтролера. Датчик температури KY-013 до AI піну тому, що даний датчик аналогового типу без вбудованого АЦП, та має живлення від мікроконтролера. Датчик температури та вологи DTH-11 під'єднано до DI входу тому, що даний датчик аналогового типу але має вбудований АЦП і подає на вхід цифровий сигнал даний датчик живиться від мікроконтролера. Світлодіод під'єднано до DO піну, живиться від живлення мікроконтролера.

До Arduino NANO під'єднано наступні компоненти:

- Динамік KY-006;
- Реле;
- Світлодіоди 2 шт.;
- Кнопки 3 шт.

Динамік KY-006 під'єднано до DO піну, живлення від мікроконтролеру. Реле під'єднано до DO піну, живлення від мікроконтролеру, до реле під'єднано:

- До NO контакту лампа розжарювання 5В.
- До NC контакту куллер 5В.
- До COM контакту 5В з блоку живлення.

Світлодіоди під'єднано до DO пінів, живлення від мікроконтролеру. Кнопки під'єднано до DO пінів, живлення від мікроконтролеру.

**2.2Принципові схеми та схеми підключення**

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/elektronic.jpg)

Рисунок 2.2.1 – Принципова електрична схема системи

Беручи за основу структурну схему розумного дому було розроблено принципову електричну схему підключення. На принциповій схемі зображено дві Arduino до яких підключаються датчики та виконавчі механізми. В системі присутній контур вимірювання температури на вулиці реалізований за допомогою датчика терморезистора. Також присутній контур який вимірює температуру та вологость в будинку для підтримки заданих параметрів клімату. Найбільший контур по кількості елементів це контур сигналізації призначений для безпеки приміщення. Присутні ще контури освітлення які були реалізовані як в середині будинку так і зовні.

Усі необхідні компоненти та матеріали для монтажу схеми розумного будинку вписані у відомість апаратних засобів в таблиці 2.1.

Таблиця 2.1 – Відомість апаратних засобів

| Назва компоненту | Кількість | Опис | Примітка |
| --- | --- | --- | --- |
| Макетна плата MB-102 830 отворів | 2 | https://arduino.ua/prod361-maketnaya-plata-mb-102-830-otverstii ||
| Контролер Arduino Uno Rev3 (ATmega16U2) | 1 | https://arduino.ua/prod676-arduino-uno-rev3 | З кабелем живлення |
| Arduino Nano V3.0 AVR ATmega328P з розпаяними роз'ємами | 1 | https://arduino.ua/prod166-arduino-nano-v3-0-avr-atmega328p-s-raspayannimi-razemami |
| Кабель USB - Mini USB (USB 2.0 AM/5p) 3 метра Blue (5123) PR | 1 | https://prom.ua/p1623631452-kabel-usb-mini.html |
| Набір з'єднувальних проводів 120 шт (20 см.) для Arduino | 1 | https://rozetka.com.ua/249475521/p249475521/ ||
| Модуль терморезистора (датчик температури) KY-013 для Arduino | 1 | https://electronica.in.ua/ua/p1530391926-modul-termorezistora-datchik.html?source=merchant\_center&srsltid=AWLEVJwB37-0235N7jptMuDjKdo0kEA2yVFjYvCU4RagR64ofHRDzc\_qJNU |
| Waveshare DHT11 Датчик Температури Вологості | 1 | https://evo.net.ua/waveshare-dht11-datchik-temperatury-vlazhnosti-9535/ |
| Модуль звука датчик звуковой пассивный зуммер пищалка для ардуино Arduino Buzzer KY-006 | 1 | https://bigl.ua/p658761378-modul-zvuka-datchik |
| KY-019 5V один 1-канальний модуль релейної плати щит для реле arduino | 1 | https://www.aliexpress.com/item/1005001643963345.html?\_randl\_currency=UAH&\_randl\_shipto=UA&src=google&aff\_fcid=63149151329c4183bfbf77b23b11fc6a-1653825412133-05922-UneMJZVf&aff\_fsk=UneMJZVf&aff\_platform=aaf&sk=UneMJZVf&aff\_trace\_key=63149151329c4183bfbf77b23b11fc6a-1653825412133-05922-UneMJZVf&terminal\_id=816c821c09a04ef387d3278f8c04bf6b&afSmartRedirect=y ||
| Датчик світла (фоторезистор) KY-018 | 1 | https://smartgear.com.ua/p877267816-datchik-sveta-fotorezistor.html | |
| Кнопка 6x6x7мм | 3 | https://arduino.ua/prod3928-knopka-6x6x7mm ||
| Резистор 10 КОм (5 штук) | 1 | https://arduino.ua/prod1970-rezistor-10-kom-5-shtyk | |
| Резистор 1 КОм (5 штук) | 1 | https://arduino.ua/prod1969-rezistor-1-kom-5-shtyk ||
| Світлодіод 10мм білий ультраяскравий | 3 | https://arduino.ua/prod448-svetodiod-10mm-belii-yltrayarkii | |
| Блок живлення Led-One 200W 5V | 1 | https://rozetka.com.ua/278751073/p278751073/ ||
| Корпусний кулер Gembird FANCASE2 | 1 | https://epicentrk.ua/ua/shop/korpusnyy-kuler-gembird-fancase2.html?srsltid=AWLEVJxcP-0avyo0PBb4xkIAcA1kdGqSbFrvTi3C5kcNXAY6ZJ-kzzTzYWs |
| Лампа розжарювання мініатюрна МН 6,5-0,34 Е10/13| 1 | https://svitlomag.all.biz/lampa-nakalivaniya-miniatyurnaya-mn-6-5-0-34-e1013-g26801997?utm\_currency=UAH&utm\_source=google&utm\_medium=cpc&utm\_campaign=shopping\_ua\_personal&utm\_content=298299 |
 

**2.3Відомість апаратних та програмних засобів**

Репліка оригінальної Arduino Uno Rev3. Виробництво - Китай. Від попередніх версій контролер відрізняється мікросхемою USB-UART перехідника (ATMega16u2), особливість мікросхеми - висока швидкість передачі даних та відсутність потреби додаткової інсталяції драйверів. Вони встановлюються автоматично при інсталяції середовища розробки Arduino IDE. Також Uno має додаткові контакти SDA і SCL (I2C інтерфейс), виводи AREF джерела опорногї напруги для АЦП контролера та IOREF - вихід напруги живлення портів введення-виведення (для автоматичного перемикання напруги периферії при використанні 5В і 3,3 контролерів). У всьому іншому це все той же контролер Arduino UNO на базі мікроконтролера Atmega328 з масою прикладів програм, бібліотек і опису побудови готових конструкцій. Зовнішній вигляд Arduino UNO показано на рисунку 2.3.1.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/UNO.jpg)

Рисунок 2.3.1 – Контролер Arduino UNO

Для програмування використовується спрощена версія C++. Розробку ПЗ можна вести як з використанням безкоштовного середовища Arduino IDE, так і за допомогою довільного C/C++ інструментарію. Для програмування та передачі даних на ПК потрібен USB-кабель, а для автономної роботи можна використати блок живлення, батарейки чи акумулятор на 7-12 В роз'єм 5.5\*2.1мм.

Характеристики контролера Arduino UNO:

- Мікроконтролер - ATmega328P;
- Частота - 16 МГц;
- Флеш пам'ять - 32Кб;
- EEPROM пам'ять - 1Кб;
- Цифрові входи/виходи - 14 (6 з них можуть працювати в режимі ШІМ);
- Аналогові входи – 6;
- Напруга живлення - 7-12 В;
- Розмір - 68 х 53 х 15 мм;
- Вага - 25 г.

Arduino Nano V3.0 – невелика самодостатня плата, сумісна з макетними платами, яка побудована на мікроконтролері ATmega328. Вона в основному збігається за функціональністю з Arduino Duemilanove/Uno, але має інший форм-фактор. Arduino Nano не вистачає тільки роз'єму живлення і замість стандартного, використовує Mini-B USB кабель (комплектація не включає кабель). Зовнішній вигляд Arduino Nano показано на рисунку 2.3.2.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/Nano.jpg)


Рисунок 2.3.2 – Контролер Arduino Nano

Для підключення до комп'ютера використовується мікросхема CH340G (посилання на драйвер нижче). Arduino Nano може живитись від Mini-B USB роз'єму або зовнішнього джерела живлення 6-12В (пін "Vin") або 5В стабільного зовнішнього живлення (пін "5V"). Живлення автоматично перемикається на джерело з більш високою напругою.

Характеристики:

- Мікроконтролер: ATmega328P;
- Тип корпусу: TQFP-32;
- Робоча напруга: 5В;
- Вхідна напруга (рекомендована): 7-12В;
- Цифрових входів / виходів: 14 (з яких 6 можуть бути використані як ШІМ);
- Аналогових входів: 8;
- Сила струму на входах / виходах: 40 мА;
- Сила струму для 3.3В виходу: 50 мА;
- Пам'ять: 32 кБ з яких 2кб використовується бутлоадер;
- SRAM: 2 кБ;
- EEPROM: 1 кБ;
- Частота: 16 МГц.

Модуль аналогового терморезистора **KY-013 який показаний на рисунку 2.3.3** призначений для визначення температури повітря навколишнього середовища. Плата модуля складається з: SMD резистора номіналом 10 кОм і датчика температури **KY-013**. Даний модуль може використовуватися в системі охолодження повітря, домашньої сигнальної системи й інших проектах.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/ky_13.jpg)

Рисунок 2.3.3 – Модуль аналогового терморезистора **KY-013**

Терморезистор KY-013 і резистор зібрані за схемою резисторного дільника напруги. При зміні температури змінюється опір температурного датчика, що призводить до зміни напруги на виводі даних. Після чого, контролер вимірює отримане напруги і за формулою логарифмічного перетворення, перетворює напругу в температуру. Так само за допомогою модуля можна визначати температуру поверхні.

Для це, необхідно механічно притиснути датчик до поверхні за допомогою кріплень, через роз'єми на платі, а між поверхнею і терморезистором нанести теплопроводящую пасту. У разі відсутності пасти приклеїти датчик.

На модулі знаходяться три виходи для підключення датчика до плати Arduino. Контакт VCC служить для подачі харчування на плату модуля, відповідно вихід GND є заземленням. Контакт S використовується для передачі даних датчика мікроконтролеру і підключається до аналогових виходів плати Arduino Uno.

Технічні характеристики модуля:

- Модель KY-013;
- Напруга живлення, В 3,3 ... 5;
- Діапазон робочої температури, °C -55 ... +125;
- Точність вимірювання, °C ±0.5.

Waveshare DHT11 датчик температури вологості (9535) — модуль вимірювання температури та вологості із вбудованим датчиком DHT11 який показаний на рисунку 2.3.4 використовується для визначення температури та вологості навколишнього середовища через стандартний однопровідний інтерфейс. Він застосовується в метеостанціях, контролю вологості, в різних контрольно-вимірювальних приладах.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/DHT11.jpg)

Рисунок 2.3.4 – Датчик температури вологості Waveshare DHT11

Технічні характеристики:

- Дискретність 1 ;
- Точність ±2℃;
- Вимірюваний діапазон 0°C ~ 50°C;
- Дискретність 1%RH;
- Точність ±5%RH (0~50°C);
- Вимірюваний діапазон 20%RH ~ 90%RH (25°C);
- Робоча напруга 3.3 В ~ 5.5 В;
- Температура:10°C ~40°C;
- Вологість 60%RH і менше.

Модуль звуку для Arduino Buzzer KY-006 показаний на рисунку 2.3.5. Модуль з пасивним динаміком-пищалкою створює різні шуми засновані на різній частоті введення/виводу. Через Arduino або інші контролери цей модуль зможе легко контролювати звуки або MID музику.

Модуль широко використовуються у комп'ютерах, принтерах, сигналізаціях, електронних іграшках, автомобільному електронному устаткуванні, телефонах, таймерах та інших звукових електронних пристроях.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/KY_006.jpg)

Рисунок 2.3.5 – Модуль звуку KY-006

Характеристики:

- Робоча напруга: 3.5 – 5.5 В;
- Робочий струм: \<25 мА;
- Розмір: 19 х 15 х 12 мм;
- Колір чорний;
- матеріал: PCB;
- Вага: близько 4 р.

KY-019 5V один 1-канальний модуль релейної плати щит для реле arduino показаний на рисунку 2.3.6.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/RELE.jpg)

Рисунок 2.3.6 – Модуль релейної плати KY-019

Характеристика:

- Новий релейний модуль 5 В;
- Може використовуватися як модуль плати розробки мікроконтролера, може використовуватись для керування побутовою технікою;
- 5V-12V до керуючого сигналу TTL;
- Керуючий сигнал постійного або змінного струму, можна керувати навантаженням 220 В змінного струму;
- Є нормально розімкнений контакт та нормально замкнутий контакт;
- Світло сили;
- Індикатор перевірки, видалення, вимкнення не світиться;
- Транзисторний привід збільшення контактів управління котушкою реле з високим імпедансом.

Датчик світла (фоторезистор) KY-018 показаний на рисунку 2.3.7. KY-018 - модуль містить фоторезистор (датчик освітленості), який може застосовуватись для вимірювання інтенсивності світла або визначення його наявності/відсутності. За відсутності світла опір фоторезистора великий і сягає 1 мОм, а за його освітленні падає до кількох Ом.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/Lite.jpg)

Рисунок 2.3.7 – Датчик світла KY-018

Між "S" і "середній контакт" (+5 В) впаяний резистор 10 кОм, що разом із самим фоторезистором утворює дільник напруги, який зручно підключити до аналогового входу Arduino.

Підключення:

- "S" аналоговий вихід;
- «Середній контакт» можна підключити +5 В з Arduino плати;
- «-» загальний.

Блок живлення Led-One 200W 5V показаний на рисунку 2.3.8. Блок живлення для світлодіодної стрічки потужністю 200 Вт у перфорованому корпусі призначений для перетворення струму та підключення пристроїв з напругою 5 вольт. Габаритні розміри блоку живлення 5 вольт становлять 204х115х55мм. Корпус має ступінь захисту від пилу та вологи IP20, тому бажано встановлювати їх усередині приміщень. Гарантійний термін від виробника – 1 рік.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/BP.jpg)

Рисунок 2.3.8 – Блок живлення Led-One

Характеристики Блок живлення Led-One 200W 5V:

- Напруга на виході, 5В;
- Потужність 200 Вт;
- Клас захисту IP20;
- Сила струму 16,50 А;
- Гарантія 12 місяців.

Корпусний кулер Gembird FANCASE2 показаний на рисунку 2.3.10.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/Kuler.jpg)

Рисунок 2.3.10 – Кулер gembird fancase2

Характеристики кулера gembird fancase2:

- Розмір 9 х9 х 2.5 см;
- Тип охолодження:  вентилятор;
- Підсвітка:  без підсвічування;
- Тип підшипника:  ковзання;
- Роз'єми живлення:  3pin;
- Діаметр вентилятора:  90 мм;
- Максимальна швидкість обертання:  2800 об/хв;
- Повітряний потік:  20 CFM;
- Максимальний рівень шуму:  27 дБ;
- Регулювання обертів:  без регулювання;
- Тип пристрою:  корпусний вентилятор;
- Колір виробника:  чорний Гарантія:  3 міс;
- Комплектація:  корпусний кулер, документація;
- Розмір та вага Висота:  9 см Ширина:  9 см;
- Глибина:  2,5 см Вага:  0,67 кг.

Лампа розжарювання мініатюрна МН 6,5-0,34 Е10/13 показана на рисунку 2.3.11. Лампа МН 6,5-0,34 Е10 використовується для освітлення в кишенькових, портативних та велосипедних ліхтарях, а також як світлова сигналізація в радіо- та електроприладах.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/lamp.jpg)

Рисунок 2.3.11 – Лампа розжарювання МН 6,5-0,34 Е10/13

Характеристики лампочки розжарювання МН 6,5-0,34 Е10/13:

- Потужність 2.21 Вт;
- Діаметр 10.5 мм;
- Довжина 23 мм;
- Напруга 6.5 В;
- Робоче становище універсальне;
- Рефлектор Ні;
- Світловий потік 17.6 лм;
- Термін служби ламп 150 год;
- Тип цоколя різьблення;
- Форма лампочки кулька;
- Застосування освітлення для електротехнічних та радіотехнічних пристроїв;
- Цоколь E10/13-1.
-

**2.4**** Програмна структура система**

Програмна структура системи поділена на три комплекси:

ПЗ Arduino UNO та Arduino NANO:

- Програмне середовище Arduino IDE.

Arduino IDE це інтегроване середовище розробки програм для мікроконтролерів на базі ATMEGA. В даній системі Arduino IDE призначено розробки програм для мікроконтролеру Arduino UNO та Arduino NANO.

- СКБД MariaDB.

СКБД MariaDB – звіт від системи управління базами даних MySQL, що розробляється спільнотою під ліцензією GNU GPL. Розробку та підтримку MariaDB здійснює компанія MariaDB Corporation Ab та фонд MariaDB. В даній системі призначена для створення локальної бази даних та звіту на локальному ВЕБ-інтерфейсі.

- Середовище Node.JS.

Node.js — платформа з [відкритим](https://uk.wikipedia.org/wiki/%D0%9F%D0%BE%D0%BB%D1%96%D1%82%D0%B8%D0%BA%D0%B0_%D0%B2%D1%96%D0%B4%D0%BA%D1%80%D0%B8%D1%82%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BE%D0%B4%D1%83) [кодом](https://uk.wikipedia.org/wiki/%D0%A1%D0%B8%D1%80%D1%86%D0%B5%D0%B2%D0%B8%D0%B9_%D0%BA%D0%BE%D0%B4) для виконання високопродуктивних мережевих [застосунків](https://uk.wikipedia.org/wiki/%D0%97%D0%B0%D1%81%D1%82%D0%BE%D1%81%D1%83%D0%BD%D0%BE%D0%BA), написаних мовою [JavaScript](https://uk.wikipedia.org/wiki/JavaScript). Дана платформа призначення для розробки функцій.

- Середовище Node-red.

Node-red – середовище побудоване основі Node.js. Призначений для створення IoT-рішення, та розгортання на його основі локального серверу, який працює з глобальною мережею.

- Модулі Node-red.

Перелік модулів та їх призначення Node-red, які необхідні в даному проекті:

- node-red;

Модуль node-red – це модуль який містить в собі основні ноди для розробки рішень.

- node-red-node-serialport;

Модуль node-red-node-serialport призначений для роботи з послідовними портами, в даному проекті цей модуль необхідний для з'єднання в одну систему мікроконтролерів, забезпечення зв'язку між ними та надання можливості керування ними кінцевому користувачу.

- node-red-dashboard;

Даний модуль призначений для розробки локального ВЕБ-інтерфейсу.

- node-red-node-ui-table;

Цей модуль призначений для виведення на локальний ВЕБ-інтерфейс таблиці звіту з локальної бази даних.

- node-red-node-mysql;

Даний модуль призначено для зв'язку проекту з локальною базою даних також з його допомогою створюється звіт.

- node-red-contrib-telegrambot-home;

Цей модуль призначений для зв'язку системи з Телеграм-ботом для віддаленого керування системою.

- node-red-contrib-google-sheets;

Модуль
#
node-red-contrib-google-sheets призначений для створення звіту та збереження інформації у віддаленій базі даних.

Хмарні застосунки та сервіси:

- Google Sites.

Призначений для виведення у хмарне середовище тренди з інформацією показників температури та вологи.

- Telegram.

Призначений для віддаленого моніторингу та керування системою.

- Google Sheet.

Виконує функцію віддаленої бази даних.

ПЗ для Android (для смартфона користувача)

- MQTT Dashboard.

За допомогою цієї програми можна створювати красиві панелі управління для пристроїв, що підтримують протокол MQTT (Arduino, ESP8266, Raspberry Pi, IoT, Sonoff, Electrodragon, M2M, Мікроконтролери, датчики та сенсори, термостати, Розумний Дім)[1].

Даний застосунок виконує функцію віддаленого керування та моніторингу системи використовуючи протокол MQTT.

- Будь-який браузер.

Для виведення глобального ВЕБ-інтерфейсу.

- Телеграм-клієнт.

[Telegram](https://telegram.org/) – це програма для обміну повідомленнями, зосереджена на швидкості та безпеці. Це супершвидко, просто і безкоштовно[2].

В даній системі Телеграм-бот призначено для комунікації з системою.

**<a id="sus3">Розділ 3. Методика перевірки та засобів тестування</a>**

**3.1 Методика перевірки підсистеми**  **Edge**** -рівня**

Методика перевірки підсистеми Edge-рівня передбачає в собі перевірку окремих функцій системи, які поділені на функціональні комплекси:

- Функції вводу/виводу;
- Функції відображення на локальному Веб-інтерфейсі.

Перевірка функцій вводу виводу поділено на два етапи, а саме:

- Перевірку функцій вводу;
- Перевірка функцій виводу.

Перевірка функцій вводу виконується наступним чином:

- Використовуючи вузол debug перевіряється, що при нагріванні чи охолодженні датчиків температури у вікні Node-red відображаються коректні значення з періодичністю 2 секунди.
- Використовуючи вузол debug перевіряється, що при накладанні вологої тканини або при протиранні датчику вологості у вікні

Node-red відображаються коректні значення з періодичністю 2 секунди.

Перевірка функцій виводу виконується наступним чином:

- Використовуючи вузол inject та задаючи в ньому необхідну текстову команду та відправляючи її до відповідного com-порту перевіряється чи зміниться стан виходу мікроконтролеру.
- Якщо стан виходу мікроконтролеру змінився використовуючи вузол debug перевіряється зворотній зв'язок мікроконтролеру та Node-red а саме чи прийде повідомлення про зміну стану виходу.

Перевірка функцій відображення на локальному Веб-інтерфейсі:

- Використовуючи вузол serialin та вузол function перевіряється відображення значень температури на елементах gauge.
- При натисканні кнопки ввімкнути сигналізацію повинно з'явитися повідомлення "Увімкнено", відповідно при натисканні кнопки вимкнути повідомлення "Вимкнено". Також повинно відображатися повідомлення про стан сигналізації "В будинку безпечно" або "Спрацювала сигналізація".
- У відповідних текстових полях повинні відображатися повідомлення про стан освітлення у приміщенні та на вулиці.
- Натискаючи відповідні елементи на локальному Веб-інтерфейсі повинно бути реалізоване керування освітленням в приміщенні та на вулиці.
- Також передбачено виведення трендів значень.

**3.2 Методика перевірки функцій архівування**

Використовуючи вузол inject та вузол mysql перевіряється з'єднання всього комплексу з локальною базою даних. Коли зв'язок з базою даних встановлено перевіряється функція занесення даних та функція формування звіту з локальної бази даних, який виводить на локальний Веб-інтерфейс.

**3.3 Методика перевірки аналітичних сервісів**

Методика перевірки підсистеми аналітичних сервісів передбачає в собі перевірку окремих функцій системи, які приставляють собою відображення звітів та графіків.

Перевірка функцій вводу виводу поділено на два етапи, а саме:

- Перевірку функцій вводу;
- Перевірка функцій виводу.

Перевірка функцій вводу виконується наступним чином:

- Використовуючи меню ContextData перевіряється, що занесло дані з датчиків в Global зміну.

Перевірка функцій виводу виконується наступним чином:

- Використовуючи вузол inject та задаючи в ньому необхідний інтервал відправки сигналу на вузол function для формування масиву, перевіряється чи сформувався масив даних вузлом debug на виході функції.
- Якщо потрібний нам масив сформувався правильно, відправляється на googlesheets, перевіряється дані які були відправлені з Node-red що сформувались в масиві.

**3.4 Методика перевірки діалогових сервісів**

Методика перевірки підсистеми діалогових сервісів передбачає в собі перевірку окремих функцій системи, які приставляють собою відображення звітів та графіків.

Перевірка функцій вводу виводу поділено на два етапи, а саме:

- Перевірку функцій вводу;
- Перевірка функцій виводу.

Перевірка функцій вводу виконується наступним чином:

- Використовуючи вузол debug перевіряється, що є зворотній зв'язок від користувача telegram по кожній з операцій контекстного меню.

Перевірка функцій виводу виконується наступним чином:

- Використовуючи вузол command та задаючи в ньому необхідну команду для спрацьовування, перевіряється відправка відповіді на команду та контекстне меню для роботи з програмою Node-red.

**<a id="sus4">Розділ 4. Розробка та налагодження програмного забезпечення та супровідної документації.</a>**

**4.1 ПЗ для**  **Edge -рівня**

Програмна структура комплексу поділена на два окремих програмних комплекси а саме:

- Програми керування в мікроконтролерах;
- Програма керування мікроконтролерами.

Програми керування в мікроконтролерах розроблені в програмному середовищі ArduinoIDE. Для кожного мікроконтролеру розроблено власну програми для виконання різних функцій.

Програма для мікроконтролеру ArduinoUNO повинна передбачати наступні функції:

- Моніторинг з періодичністю 2 секунди значень температурив будинку та на вулиці та вологи в будинку;
- Моніторинг рівня освітленості на вулиці;
- Моніторинг стану освітлення на вулиці.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/prog_UNO_1.jpg)

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/prog_UNO_2.jpg)

Рис.4.1.1 –Програма для мікроконтролеру ArduinoUNO

Моніторинг температури та вологи в будинку реалізовано за допомогою датчика DTH11, який має функції вимірювання температури та відносної вологості та за допомогою вбудованого АЦП передає інформацію на цифровий вхід мікроконтролера.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/UNO_P_LB.jpg)

Рис.4.1.2 – Ініціалізація входів та необхідних бібліотек

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/UNO_P_seting.jpg)

Рис.4.1.3 – Задання початкових налаштувань мікроконтролера

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/UNO_temperature.jpg)

Рис.4.1.4 – Реалізація функцій моніторингу температури та вологості в приміщенні

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/UNO_temperature_out.jpg)

Рис.4.1.5 – Реалізація функції моніторингу температури на вулиці

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/UNO_lite.jpg)

Рис.4.1.6 – Реалізація функції керування світлом на вулиці та функції моніторингу рівня освітленості

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/UNO_WRITE_COM.jpg)

Рис.4.1.7 – Реалізація занесення значень до послідовного порту

Програма для мікроконтролеру ArduinoNANO повинна виконувати наступні функції:

- Керування та моніторинг сигналізації;
- Керування станом світла в приміщенні;
- Керування мікрокліматом в приміщенні.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/Prog_Nano_1.jpg)

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/nano_2.jpg)

Рис. 4.1.8 – Програма для мікроконтролеру ArduinoNANO

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/nano_init.jpg)

Рис.4.1.9 – Ініціалізація входів та виходів мікроконтролеру

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/Nano_sig.jpg)

Рис.4.1.10 – Реалізація контуру сигналізації

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/Nano_lite.jpg)

Рис.4.1.11 – Реалізація функції керування освітленням

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/Nano_climat_control.jpg)

Рис.4.1.12 – Реалізація функції керування мікрокліматом

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/Image/nano_write_com.jpg)

Рис.4.1.13 – Занесення значень до послідовного порту

До підсистеми Edge-рівня відноситься два потоки Flow:

- Розумний дім;
- Локальна база даних.

У потоці "Розумний дім" реалізоване керування всіма функціями мікроконтролерів.

Програма керування мікроконтролерами, має в собі поєднувати функції обох мікроконтролерів та доповнювати їх необхідними елементам зовнішній вигляд програми керування мікроконтролерами показано на рисунку 4.1.14.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/All_pr.jpg)

Рис.4.1.14 – Програма керування розумним домом

Програма керування поділена на три окремі підпрограми а саме:

- Програма керування сигналізацією;
- Програма керування мікрокліматом;
- Програма керування освітленням.

Програма Сигналізації наведена на рисунку 4.1.15.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/Sig.jpg)

Рис.4.1.15 – Реалізація контуру сигналізації

Для реалізації сигналізації було використано наступні розширення:

- Для з'єднання програми з фізичними мікроконтролерами використано розширення node-red-node-serialport;
- Для відображення даних та повідомлень на локальному Веб-інтерфейсі використано розширення node-red-dashboard;
- Для реалізації всіх функцій та задач використано стандартне розширення node-red.

Інформація про стан сигналізації та стан вимикачів отримується за допомогою елементів serial-in та два блоки function рисунок 4.1.16.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/read_nano.jpg)

Рис.4.1.16 – Реалізація читання даних з ArduinoNANO

У першій функції масив даних, що надходить з послідовного порту перетворюється у текстове повідомлення, після чого дане повідомлення надходить до другої функції у якій розділяється на окремі змінні, кожна з таких змінних має власний вихід з функції.

З функції виходять чотири змінні, три з яких являють собою кнопки, які емулюють кінцеві вимикачі рисунок 4.1.17.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/konc.jpg)

Рис.4.1.17 – Реалізація кінцевих вимикачів

Четвертий сигнал являє собою вихід мікроконтролера, що відповідає за стан сигналізації. Сигнал з останнього виходу функції йде на додаткову обробку рисунок 4.1.18.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/last_sig.jpg)

Рис.4.1.18 – Реалізація останнього сигналу з функції

Четвертий сигнал обробляється по принципу, при запуску програмі за допомогою вузла inject задаються початкові значення, котрі виводяться на локальний Веб-інтерфейс.

Після обробки всіх сигналів вони групуються та передаються до функції кінцевої обробки рисунок 4.1.19.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/last_fun.jpg)

Рис.4.1.19 – Реалізація кінцевої функції

Програма сигналізації працює по наступному алгоритму: з послідовного порту надходять сигнали з відповідних елементів системи у вигляді масиву, який перетворюється у текстове повідомлення після чого розбивається на окремі сигнали. Сигналізація працює з перетвореними у глобальні змінні сигнали, які надходять до функції у якій перевіряється дві умови чи увімкнено сигналізацію зараз і чи спрацював будь-який кінцевий вимикач, якщо виконуються усі умови на виході функції буде сформована текстова команда, яка передається до мікроконтролеру та вмикає сигналізацію інакше формується команда , що сигналізує про те що тривога відсутня.

Програма керування мікрокліматом показана на рисунку 4.1.20.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/klimat.jpg)

Рис.4.1.20 – Програма керування мікрокліматом

Керування мікрокліматом відбувається за допомогою реле до якого під'єднано обігрівач та систему охолодження повітря.

Система реалізована за допомогою двох мікроконтролерів Arduino, до мікроконтролеру ArduinoUNO підключений датчик вимірювання вологи та температури DTH11, який знаходиться в середині дому та датчик температури KY-013 для вимірювання температури на вулиці. До мікроконтролеру ArduinoNANO підключено реле, до контактів якого під'єднано обігрівач та система охолодження повітря.

Отримання інформації з датчиків реалізовано аналогічно з сигналізацією, налаштування порту для ArduinoUNO показано на рисунку 4.1.21.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/seting_UNO.jpg)

Рис.4.1.21 – Налаштування порту для ArduinoUNO

Інформація з датчиків виводиться на локальний Веб-інтерфейс та на віддалені хмарні застосунки рисунок 4.1.22.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/dt_veb.jpg)

Рис.4.1.22 – Вивід значень з датчиків на локальний Веб-інтерфейс

Програма керування мікрокліматом працює наступним чином: значення уставки порівнюється з значенням температури в будинку і якщо значення уставки менше значення температури вмикається система охолодження повітря, якщо значення уставки більше значення температури вмикається обігрівач.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/cl_cont.jpg)

Рис.4.1.23 – Програмна реалізація клімат-контролю

Мікроконтролер отримує від node-red текстові команди та відповідно до команди вмикає або відмикає виходи. Однією з цілей реалізації контролю мікроклімату було об'єднати два мікроконтролери, котрі не мають фізичного зв'язку. До одного мікроконтролеру під'єднані датчики, які збирають та передають інформацію на сервер котрий в залежності від отриманих даних посилає на інший мікроконтролер текстові команди.

Програма керування світлом показана на рисунку 4.1.24

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/lite.jpg)

Рис.4.1.24 – Програма керування освітленням

Програма керування освітленням поділено на дві частини а саме:

- Світло в будинку ArduinoNANO;
- Світло на вулиці ArduinoUNO.

Інформація щодо стану освітлення передається за допомогою елементів linkin.

У програмі керування освітленням на вулиці передбачено два режими ручний та автоматичний.

При першому розгортанні програми вмикається автоматичний режим освітлення на вулиці. Програму керування освітленням на вулиці показано на рисунку 4.1.25.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/lite_out.jpg)

Рис.4.1.25 – Програма керування освітленням на вулиці

Датчик освітлення являє собою фоторезистор об'єднаний зі звичайним резистором який призначений для пониження напруги живлення.

В автоматичному режимі програма порівнює значення опору з датчика освітленості та порівнює його зі перевіреним значенням опору у темну пору доби тобто коли датчик затемнено, якщо значення з датчику більше нього світло вмикається інакше світло вимикається рисунок 4.1.26.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/auto_lite_out.jpg)

Рис.4.1.26 – Автоматичний режим керування світлом на вулиці

Ручне керування світлом працює по спрощеному алгоритму а саме початкова функція отримує текстове значення з елементу linkin та перетворює його у булеві сигнали. Якщо користувач вмикає ручний режим під час роботи автоматичного то в такому випадку автоматичний режим вимикається для уникнення конфлікту операцій. У випадку ввімкнення ручного режиму сигнал про це передається до функції, яка форму текстову команду, що повинна ввімкнути світло, якщо користувач вимикає ручний режим світло вимкнеться а автоматичний режим потрібно буде ввімкнути вручну.

Реалізацію ручного режиму показано на рисунку 4.1.27.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/hand_lite_out.jpg)

Рис.4.1.27 – Ручний режим керування світлом на вулиці

Режим керування світлом в будинку реалізовано наступним чином з елементу linkin початкова функція отримує необхідний сигнал, який перетворює у відповідний булевий сигнал, який йде до елементу switch. Після проходження елементу switch сигнал перетворюється у глобальну змінну та передається до кінцевої функції, яка формує текстові команди для рисунок 4.1.28.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/lite_in.jpg)

Рис.4.1.28 – Програма керування освітленням в приміщенні

Реалізація зв'язку з локальною базою даних показана на рисунку 4.1.29.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/local_SQL.jpg)

Рис.4.1.29 – Flow Локальна база даних

Програма зв'язку з локальною базою даних умовно поділена на дві частини перша частина відповідає за запис даних в БД друга – за формування звіту подій.

Програма занесення даних до БД показана на рисунку 4.1.30.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/loc_sql_1.jpg)

Рис.4.1.30 – Програма занесення даних до БД

Дані заносяться до БД за допомогою двох функцій. Перша функція формує з усих необхадних змінних однин об'єкт, який передає наступній функції котра в свою чергу заносить дані до БД. Друга функція являє собою створення однієї змінної, яка у собі несе інформацію про те, у яку таблицю, в які поля та які змінні заносити. Після формування змінної пона передається до ноди mysql, яка передає ці дані до локальної БД.

Програма формування звіту показана на рисунку 4.1.31.

Звіт формується за допомогою запиту на вибірку по часу. У запиті вказується з яких полів необхідно вибрати дані, також відносно якого поля та умови відносно цього поля буде робитись вибірка. У даному випадку вибірка формується відносно поля TS, яке несе в собі інформацію про час. Звіт формується за останню годину по запиту користувача, або автоматично кожну годину.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/loc_sql_2.jpg)

Рис.4.1.31 – Програма формування звіту локальної БД

**4.2 Схема інформаційної взаємодії**

В цьому пункті описано яким чином взаємодіють всі програмні засоби які були використані при створені курсової роботи. Програмні засоби були вибрані під потреби цієї роботи для виконання поставлених задач. Головною базою для розробки використовується Node-RED через який взаємодіють всі інші програми.

Були вибрані такі програмні засоби:

- Node-RED як база для розробки ПЗ + dashboard для локального веб-інтерфейсу;
- Arduino IDE як база розробки ПЗ для мікроконтролерів;
- Система керування базами даних, розгорнута на RPI (MariaDB);
- Хмарний застосунок Google Sheets для аналітики;
- Веб-сайт для онлайн доступу для звітів на базі Google Sites;
- Telegram-бот для віддаленого контролю та керування;
- MQTT Dashboard для віддаленого контролю та керування.

Самий важливий програмний засіб який ми використовуємо це Arduino IDE. Тому що він слугує базою для розробки програми керування для мікроконтролерів які керують всією системою розумного будинку. Приклад реалізація з'єднання Arduino IDE та Node-RED показано на рисунку 4.2.1.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/arduino_node_red.jpg)

Рисунок 4.2.1 – З'єднання Arduino IDE та Node-RED

Для з' єднання програмного засобу Arduino IDE до Node-RED було використано бібліотеку node-red-node-serialport. Підключення реалізується за допомогою блоків: link in, link out, serial in, serial out.

В даному проекті для реалізації локальної бази даних використовується MariaDB. В яку приходить інформація про стан всієї системи і записується для подальшого аналізу. Приклад реалізація з'єднання MariaDB та Node-RED показано на рисунку 4.2.2.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/sql_node_red.jpg)

Рисунок 4.2.2 – З'єднання MariaDB та Node-RED

Для з' єднання програмного засобу MariaDB до Node-RED було використано бібліотеку node-red-node-mysql. Підключення реалізується за допомогою блоків: link in, mysql.

Також для зручності відслідковування та керування системою користувачем було використано Telegram. Це було реалізовано за допомогою Telegram-бота який може відправляти повідомлення про стан системи і користувач може управляти шляхом вибору потрібної кнопки. Приклад реалізація з'єднання Telegram та Node-RED показано на рисунку 4.2.3.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/telegram_all.jpg)

Рисунок 4.2.3 – З'єднання Telegram та Node-RED

Для з' єднання програмного засобу Telegram до Node-RED було використано бібліотеку node-red-contrib-telegrambot-home. Підключення реалізується за допомогою блоків: link in, link out, command, notify.

З' єднання по протоколу MQTT використовується для віддаленого контролю та керування системою за допомогою додатку для смартфону. Приклад реалізація з'єднання MQTT Dashboard та Node-RED показано на рисунку 4.2.4.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/mqtt.jpg)

Рисунок 4.2.4 – З'єднання MQTT Dashboard та Node-RED

Для з' єднання програмного засобу MQTT Dashboard до Node-RED було використано бібліотеку node-red. Підключення реалізується за допомогою блоків: link in, link out, mqtt in, mqtt out.

Для онлайн доступу до звітів використовується веб-сайт на базі Google Sites. Також для аналітики використовується хмарний застосунок Google Sheets. Приклад реалізація з'єднання Google Sites та Google Sheets до Node-RED показано на рисунку 4.2.5.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/google.jpg)

Рисунок 4.2.5 – З'єднання Google Sites та Google Sheets до Node-RED

Для з' єднання програмного засобу Google Sites та Google Sheets до Node-RED було використано бібліотеку node-red. Підключення реалізується за допомогою блоків: link in, http request.

**4.3**  **ПЗ для хмарних рішень**

Список функцій, для реалізації роботи телеграм-бота:

- налаштування температури
- налаштування сигналізації
- налаштування світла
- отримування звіту

Зовнішній вигляд програми керування налаштуваннями температури показано на рисунку 4.3.1.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/temp_tel.jpg)

Рис.4.3.1 – Прогамна реалізація функцій налаштування температури

Перевіряємо роботу управління температурою в телеграмі, яка зображена на рисунку 4.3.2.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/tel_bot_tp.jpg)
Рис. 4.3.2 – Перевірка telegrambot управління температурою

Аналогічно алгоритму відправки температури, реалізована і відправка та налаштування світла командою «/light». Включення та виключення світла реалізовано контекстими меню та на виході з елементу «switch» окрім повідомлень користувачу використовуються елементи «change» в яких присвоюється повідомленню «true» або «false» та далі передається на головну програму, зображення програми керування освітленням наведено на
 рисунку 4.3.3.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/tel_lite.jpg)

Рис. 4.3.3 – Програма керування освітленням

Перевіряємо роботу управління світлом в телеграмі, яка зображена на
 рисунку 4.3.4.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/tel_bot_lite.jpg)

Рис. 4.3.4 – Перевірка telegrambotуправління світла

Реалізовано сигналізацію в будинку (/signal) таким чином, що кожному користувачеві буде відправлятись повідомлення в випадку спрацювання сигналізації та вимкнення сигналізації одним із користувачів.

Зображення програми показано на рисунку 4.3.5.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/tel_sig.jpg)

Рис. 4.3.5 – Програма керування сигналізацією

Налаштування сигналізації в будинку було реалізовано наступним чином, користувач може увімкнути або вимкнути сигналізацію в будинку але його дії відправляться іншим користувачам в телеграм, що користувач №1 увімкнув сигналізацію в будинку або виключив. Після чого у разі спрацювання сигналізації кожному користувачеві надходить відповідне повідомлення.

Перевіряємо роботу управління сигналізацією в телеграмі, яка зображена на рисунку 4.3.6.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/tel_bot_sig.jpg)

Рис. 4.3.6 – Перевірка telegrambot управління сигналізацією

Відправка звіту (/zvit) реалізовано, як фільтрація користувача та повідомлення з посиланням на таблицю в Google Sheets, зображення елементів програми показано на рисунку 4.3.7.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/tel_feed.jpg)

Рисунок 4.3.7 – Відправка звіту користувачам

Перевіряємо роботу відправлення посилання на Google Sheets в телеграмі, яка зображена на рисунку 4.3.8.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/tel_bot_feed.jpg)

Рис. 4.3.8 – Перевірка telegrambot відправлення посилання

Реалізація відправки інформації до google sheets

Список даних є наступним котрі необхідно вносити до віддаленої бази даних:

- значення температури в будинку
- значення температури на подвір'ї
- значення світла в будинку
- значення світла на подвір'ї
- значення вологи в будинку
- стан сигналізації

Визначивши список даних які будуть передаватись, переходимо в Node-red. Та створюємо програму яка собою являє елемент «inject», «function»,
 «httprequest», зображення програми відправки даних в таблицю на
 рисунку 4.3.9.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/sheet_out.jpg)

Рис. 4.3.9 – Відправка значень в google sheets

Принцип роботи полягає в тому що в глобальні змінні записуються значення далі в функції формується масив значень які будемо передавати та присвоюємо в «msg.payload» масив «sheet» та передаємо в «httprequest» з інтервалом який вказаний в «inject».

Для коректного відправлення даний через «httprequest», в даному випадку змінюємо значення в посиланні на ті які потрібно відправляти. Змінюємо параметр «viewform» в посиланні на «formResponse» та значення які ми вказували при заповнені форми змінюємо на «{{payload. «зміна яку передаємо» }}», далі нам потрібно вставити змінене посилання в «httprequest» та налаштувати періодичність відправлень, налаштування посилання та
 «httprequest» зображено на рисунку 4.3.10 і 4.3.11

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/link_google.jpg)

Рис. 4.3.10 – Налаштування посилання для роботи з google sheets

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/setting_sheets.jpg)

Рис. 4.3.11 – Налаштування «httprequest» для роботи з google sheets

Перевіряємо роботу відправлення даних на Google Sheets з інтервалом на відправлення 1 хвилина, перегляд даних відправлених через Node-red на Google Sheets зображено на рисунку 4.3.12.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/shet_feedback.jpg)

Рис. 4.3.12 – Перевірка роботи відправлення даних на Google Sheets

**4.4**  **WEB** **-інтерфейси (локальний та глобальний)**

Локальний Веб-інтерфейс реалізовано у вигляді dashboardnode-red. Він складається з двох сторінок: Розумний дім та Звіт по будинку. Сторінка Розумний дім показана на рисунку 4.4.1.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/smart_house.jpg)

Рис.4.4.1 – Зовнішній вигляд сторінки Розумний дім

Сторінка Звіт по будинку показана на рисунку 4.4.2.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/file_sql.jpg)

Рис.4.4.2 – Сторінка Звіт по будинку

На рисунку 4.4.3 показано Графіки змін показників за добу

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/grafik.jpg)

Рис.4.4.3 – Графіки змін показників за добу

Актуальні показники температури та вологості а також зміна уставки показано на рисунку 4.4.4.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/veb_seting.jpg)

Рис.4.4.4 – Налаштування температури

Керування світлом та сигналізацією через Веб-інтерфейс показано на рисунку 4.4.5.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/lite_sig.jpg)

Рис.4.4.5 – Світло та сигналізація

Також змінивши налаштування Node-red та додавши ноду template було змінено фон локального Веб-інтерфейсу рисунок 4.4.6.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/template.jpg)

Рис.4.4.6 – Налаштування ноди template та вигляд локального Веб-інтерфейсу

Глобальний Веб-інтерфейс реалізовано у вигляді сайту на хмарному хостингу heroku. Складається з головної сторінки, сторінки з графіками та посиланням на Google Sheets.

Відправка даних на сайт відбувається наступним чином, «inject» відправляє сигнал на функцію яка в свою чергу виконує формування тренду «trends» та відправку його з використанням «httprequest», зображення елементів програми показано на рисунку 4.4.7.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/global_serv.jpg)

Рис. 4.4.7 – Елемент роботи програми для відправки даних на глобальний сервер

Обробка даних проходить на сервері за допомогою обробника POST, зображення фрагменту обробника показано на рисунку 4.4.8.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/code_post.jpg)

Рис 4.4.8 – Фрагмет коду для обробки POST

Далі необхідно використати обробник для серверу, який віддавав би збережені в масиві дані у форматі, який визначений для заповнення графіку. Для цього використовуємо функцію яка буде вибирати дані за вказаний період, зображена на рисунку 4.4.9

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/code_graf.jpg)

Рис. 4.4.9 – Фрагмент коду для відправлення масиву у форматі для заповнення графіку

Добавляємо обробник для маршруту «/gettrend» та перевіряємо як працює вивід інформації за поселанням на який повинно приходити дані які відправляються з Node-red та оброблюються на сайті за наступним посиланням «https://«сайт»/gettrend» в нашому випадку, зображення кейсу для виводу інформації показано на рисунку 4.4.10 та перевірка роботи на рисунку 4.4.11.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/gettrend.jpg)

Рис. 4.4.10 – Кейс gettrend для відображення даних

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/gettrend_res.jpg)

Рис. 4.4.11 – Результат роботи кейсу

Потім вставляємо фрагмет коду на сайт для виводу графіків на сайт, фрагмент коду зображений на рисунку 4.4.12 та перевіряємо робота на сайті.

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/graf_serv.jpg)

Рис. 4.4.12 – Фрагмет коду для роботи графіку на глобальному сервісі

![Image alt](https://github.com/danya-andrienko/Kursove/blob/main/image_node-red/serv_viev.jpg)

Рис. 4.4.13 – Вигляд роботи графіку на глобальному сервісі
  


Фото розробленої моделі емуляції розумного дому:
![IMG_20220423_173816](https://user-images.githubusercontent.com/68506045/164910794-6a57ccce-0eff-4682-8826-38ed5a88d3d1.jpg)
![IMG_20220423_173909](https://user-images.githubusercontent.com/68506045/164910801-55852166-4360-4756-b9bd-6fe1d860848d.jpg)
